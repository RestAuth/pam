#!/usr/bin/make -f

DEB_HOST_MULTIARCH ?= $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)
export DEB_BUILD_MAINT_OPTIONS = hardening=+all
DPKG_EXPORT_BUILDFLAGS = 1
include /usr/share/dpkg/buildflags.mk

LDFLAGS += -shared -fPIC

%:
	dh $@

pam_restauth.so: pam_restauth.c
	$(CC) $(CPPFLAGS) $(CFLAGS) $(LDFLAGS) -o pam_restauth.so pam_restauth.c -lcurl -lpam

override_dh_auto_build: pam_restauth.so

override_dh_auto_configure:
	dh_auto_configure
	sed 's/@DEB_HOST_MULTIARCH@/$(DEB_HOST_MULTIARCH)/g' \
                debian/libpam-restauth.install.in > debian/libpam-restauth.install
